<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bit6 Web Demo">
    <meta name="author" content="Bit6">
    <title>Bit6 OAuth 0.9.9</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script id="digits-sdk" src="https://cdn.digits.com/1/sdk.js" async></script>
</head>
<body>
<div class="container">
    <div id="welcome">
        <div class="intro"><h1>Bit6 OAuth with SDK</h1>
            <p class="lead">Sign in with 3rd party OAuth providers using Bit6 SDK</p></div>
        <button type="button" class="btn btn-primary" id="googleButton">Google</button>
        <button type="button" class="btn btn-primary" id="facebookButton">Facebook</button>
        <button type="button" class="btn btn-primary" id="zendeskButton">Zendesk</button>
        <button type="button" class="btn btn-primary" id="deskcomButton">Desk.com</button>
        <button type="button" class="btn btn-primary" id="digitsButton">Digits</button>
        <button type="button" class="btn btn-default" id="restartButton">Restart</button>
        <div style="margin-top: 20px"><p>Bit6 auth result
            <pre id="authResult"></pre>
        </div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../common/bit6.min.js"></script>
    <script>function prepareGoogle(e, b, g) {
        var a = b.client_id;
        var f = window.location.href.split("?")[0];
        var d = getGoogleAuthCode(g);
        if (d) {
            var c = {redirectUri: f, code: d,};
            e.session.oauth("google", c, function (h) {
                console.log("Bit6 google err:", h)
            })
        }
        $("#googleButton").click(function () {
            startGoogleAuth(a, f)
        })
    }

    function getGoogleAuthCode(a) {
        if (!a.code || !a.session_state) {
            return null
        }
        return a.code
    }

    function startGoogleAuth(c, f) {
        var e = "https://accounts.google.com/o/oauth2/auth";
        var d = ["openid", "profile", "email"];
        var b = [["client_id", c], ["redirect_uri", f], ["scope", d.join(" ")], ["response_type", "code"]];
        var a = b.map(function (g) {
            return g[0] + "=" + encodeURIComponent(g[1])
        }).join("&");
        window.location.href = e + "?" + a
    }

    function prepareFacebook(e, b, g) {
        var a = b.client_id;
        var f = window.location.href.split("?")[0];
        var d = getFacebookAuthCode(g);
        if (d) {
            var c = {redirectUri: f, code: d,};
            e.session.oauth("facebook", c, function (h) {
                console.log("Bit6 fb err:", h)
            })
        }
        $("#facebookButton").click(function () {
            startFacebookAuth(a, f)
        })
    }

    function getFacebookAuthCode(a) {
        if (!a.code || a.session_state || a.state) {
            return null
        }
        return a.code
    }

    function startFacebookAuth(c, f) {
        var e = "https://www.facebook.com/dialog/oauth";
        var d = ["public_profile", "user_friends", "email"];
        var b = [["client_id", c], ["redirect_uri", f], ["scope", d.join(",")], ["response_type", "code"]];
        var a = b.map(function (g) {
            return g[0] + "=" + encodeURIComponent(g[1])
        }).join("&");
        window.location.href = e + "?" + a
    }

    function prepareZendesk(f, b, h) {
        var a = b.client_id;
        var e = b.subdomain;
        var g = window.location.href.split("?")[0];
        var d = getZendeskAuthCode(h);
        if (d) {
            var c = {redirectUri: g, code: d};
            f.session.oauth("zendesk", c, function (i) {
                console.log("Bit6 zd err:", i)
            })
        }
        $("#zendeskButton").click(function () {
            startZendeskAuth(a, e, g)
        })
    }

    function getZendeskAuthCode(a) {
        if (!a.code || !a.state || "zendesk" != a.state) {
            return null
        }
        return a.code
    }

    function startZendeskAuth(c, e, g) {
        var f = "https://" + e + ".zendesk.com/oauth/authorizations/new";
        var d = ["read", "write"];
        var b = [["client_id", c], ["redirect_uri", g], ["scope", d.join(" ")], ["response_type", "code"], ["state", "zendesk"]];
        var a = b.map(function (h) {
            return h[0] + "=" + encodeURIComponent(h[1])
        }).join("&");
        window.location.href = f + "?" + a
    }

    function prepareDeskcom(c, a, e) {
        var d = window.location.href.split("?")[0] + "?state=deskcom";
        var b = getDeskcomTokenAndVerifier(e);
        if (b) {
            c.session.oauth("deskcom", b, function (f) {
                console.log("Bit6 desk err:", f)
            })
        }
        $("#deskcomButton").click(function () {
            startDeskcomAuth(c, d)
        })
    }

    function getDeskcomTokenAndVerifier(a) {
        if (!a || !a.oauth_token || !a.oauth_verifier) {
            return null
        }
        return a
    }

    function startDeskcomAuth(b, c) {
        var a = {redirectUri: c};
        b.session.oauth1_redirect("deskcom", a, function (e, d) {
            console.log("Bit6 got Desk.com oauth1 redirect", d, e);
            if (d && d.redirect) {
                window.location.href = d.redirect
            }
        })
    }

    function prepareDigits(b, a, c) {
        $("#digitsButton").click(function () {
            if (Digits.isInitialized()) {
                startDigitsAuth(b)
            } else {
                Digits.init({consumerKey: a.consumer_key}).done(function () {
                    console.log("Digits init ok");
                    startDigitsAuth(b)
                }).fail(function () {
                    console.log("Digits init failed")
                })
            }
        })
    }

    function startDigitsAuth(a) {
        Digits.logIn().done(function (b) {
            console.log("Digits login:", b);
            a.session.oauth("digits", b, function (c) {
                console.log("Bit6 digits err:", c)
            })
        }).fail(function (b) {
            console.log("Digits login err", b)
        })
    }

    $(function () {
        $("#restartButton").click(function () {
            window.location.href = window.location.href.split("?")[0]
        });
        var f = {};
        var a = window.location.href.split("?");
        if (a.length == 2) {
            a = a[1].split("&");
            a.map(function (g) {
                var h = g.split("=");
                f[h[0]] = h[1]
            });
            console.log("location.href query params", f)
        }
        var b = "4oap-2lvnm";
        var d = "prod";
        var c = window.location.href;
        if (c.indexOf("dev") > 0) {
            b = "3y9-26ufj";
            d = "dev";
            if (window.location.protocol.indexOf("https") < 0) {
                window.location.href = "https://bit6-demo-dev.firebaseapp.com/auth/"
            }
        } else {
            if (c.indexOf("localhost") > 0) {
                b = "3y9-26ufj";
                d = "local"
            }
        }
        var e = new bit6.Client({apikey: b, env: d});
        console.log("Bit6", e);
        e.session.on("auth", function () {
            $("#authResult").html(JSON.stringify(e.session.save(), null, 4))
        });
        e.session.getAuthInfo(function (g, h) {
            if (g) {
                return alert("getAuthInfo err=", g)
            }
            console.log("authInfo:", h);
            if (h.google) {
                prepareGoogle(e, h.google, f)
            }
            if (h.facebook) {
                prepareFacebook(e, h.facebook, f)
            }
            if (h.zendesk) {
                prepareZendesk(e, h.zendesk, f)
            }
            if (h.deskcom) {
                prepareDeskcom(e, h.deskcom, f)
            }
            if (h.digits) {
                prepareDigits(e, h.digits, f)
            }
        })
    });</script>
</body>
</html>


